@model DashboardVm
@using System.Text.Json
@{
    ViewData["Title"] = "Dashboard";
}

<div class="d-flex align-items-center justify-content-between mb-3">
  <h2 class="mb-0">Dashboard</h2>
  <a class="btn btn-primary" asp-controller="Clients" asp-action="Create">+ Nouveau client</a>
</div>

<div class="row g-3 mb-4">
  <div class="col-md-3"><div class="card shadow-sm"><div class="card-body"><div class="text-muted">Total</div><div class="display-6">@Model.TotalClients</div></div></div></div>
  <div class="col-md-3"><div class="card shadow-sm border-success"><div class="card-body"><div class="text-muted">High</div><div class="display-6 text-success">@Model.High</div></div></div></div>
  <div class="col-md-3"><div class="card shadow-sm border-warning"><div class="card-body"><div class="text-muted">Medium</div><div class="display-6 text-warning">@Model.Medium</div></div></div></div>
  <div class="col-md-3"><div class="card shadow-sm border-danger"><div class="card-body"><div class="text-muted">Low</div><div class="display-6 text-danger">@Model.Low</div></div></div></div>
</div>

<div class="row g-4">
  <div class="col-lg-5">
    <div class="card shadow-sm">
      <div class="card-header">Priorités</div>
      <div class="card-body">
        <canvas id="priorityChart" height="220"></canvas>
        <div class="small text-muted mt-2">Non analysés: <b>@Model.Unanalyzed</b></div>
      </div>
    </div>
  </div>

  <div class="col-lg-7">
    <div class="card shadow-sm">
      <div class="card-header">Clients par société (Top)</div>
      <div class="card-body">
        <canvas id="companyChart" height="220"></canvas>
      </div>
    </div>
  </div>
</div>

<div class="card shadow-sm mt-4">
  <div class="card-header">Créations (12 derniers mois)</div>
  <div class="card-body">
    <canvas id="monthChart" height="110"></canvas>
  </div>
</div>

@section Scripts {
<script>
  const priority = @Html.Raw(JsonSerializer.Serialize(new { high = Model.High, medium = Model.Medium, low = Model.Low, unknown = Model.Unanalyzed }));
  const byCompany = @Html.Raw(JsonSerializer.Serialize(Model.ClientsByCompany));
  const byMonth = @Html.Raw(JsonSerializer.Serialize(Model.ClientsByMonth));

  renderPriorityChart('priorityChart', priority);
  renderCompanyChart('companyChart', byCompany);
  renderMonthChart('monthChart', byMonth);
</script>
}
